<!DOCTYPE html>
<html lang="es">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHYSIO-PREPAS | Clase Introductoria</title>

    <!-- Carga de Tailwind CSS para un diseño moderno y responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Fuentes */
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap');

        :root {
            --bg-color-light: #f0f4f8;
            --bg-container-light: #ffffff;
            --text-color-light: #334155;
            --text-heading-light: #1e293b;
            --canvas-bg-light: #e2e8f0;
            --canvas-border-light: #cbd5e1;
            --sidebar-bg-light: rgba(255, 255, 255, 0.9);
            --sidebar-shadow-light: rgba(0, 0, 0, 0.2);
            --backdrop-filter: blur(10px);
        }

        body.dark-mode {
            --bg-color-light: #1e293b;
            --bg-container-light: #334155;
            --text-color-light: #e2e8f0;
            --text-heading-light: #f8fafc;
            --canvas-bg-light: #1e293b;
            --canvas-border-light: #475569;
            --sidebar-bg-light: rgba(51, 65, 85, 0.9);
            --sidebar-shadow-light: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--bg-color-light);
            color: var(--text-color-light);
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Estilos específicos del CANVAS y contenedores */
        #app-container {
            width: 100%;
            max-width: 1024px;
            display: flex;
            flex-direction: column;
            margin: 20px auto;
            gap: 20px;
        }

        #canvas-container {
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--canvas-border-light);
            background-color: var(--canvas-bg-light);
        }

        canvas {
            display: block;
            width: 100%;
            height: 400px; /* Altura por defecto, se ajustará en JS si es necesario */
        }

        #controls {
            background-color: var(--bg-container-light);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.06);
            display: grid;
            gap: 15px;
            grid-template-columns: repeat(1, 1fr);
        }

        @media (min-width: 768px) {
            #controls {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Elementos de control */
        .control-group h3 {
            color: var(--text-heading-light);
            font-weight: 700;
            margin-bottom: 10px;
        }

        .control-buttons button {
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s;
            min-width: 80px;
        }

        .control-buttons button:not(.active):hover {
            opacity: 0.8;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.875rem;
        }

        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #cbd5e1;
            border-radius: 5px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            box-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
            margin-top: -5px;
        }

        /* --- AUTH SCREEN STYLES --- */
        #auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color-light);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.3s, visibility 0.3s;
            /* Se cambia a 'relative' para que 'absolute bottom-0' funcione correctamente respecto a este div */
            position: relative; 
        }

        .auth-card {
            background-color: var(--bg-container-light);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 400px;
            width: 90%;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-top: 5px;
            margin-bottom: 15px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .input-field:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .auth-button {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            font-weight: 700;
            transition: background-color 0.2s;
        }
    </style>
</head>

<body>
    
    <!-- PANTALLA DE AUTENTICACIÓN (Se oculta al iniciar sesión) -->
    <div id="auth-screen">
        <div class="auth-card">
            <h2 class="text-3xl font-bold mb-6 text-center text-gray-800">Acceso de Estudiantes</h2>
            
            <form id="auth-form" class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">Email registrado</label>
                    <input type="email" id="email" required class="input-field" placeholder="ejemplo@clase.com">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">Contraseña</label>
                    <input type="password" id="password" required class="input-field" placeholder="Contraseña asignada">
                </div>
                
                <button type="submit" id="main-auth-button" class="auth-button bg-blue-600 text-white hover:bg-blue-700">
                    Acceder a la Simulación
                </button>

                <p id="auth-error-message" class="text-red-500 text-center text-sm mt-3 hidden">
                    Mensaje de error
                </p>

                <div class="text-center pt-4">
                    <!-- BOTÓN DE REGISTRO (AHORA ES UN ENLACE DIRECTO) -->
                    <a href="https://forms.gle/yVMN8S28qtZn1ovJ8" target="_blank" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                        ¿Aún no tienes cuenta? Regístrate aquí.
                    </a>
                </div>
            </form>
        </div>

        <!-- Footer ajustado, se eliminó la referencia a PHYSIO-PREPAS -->
        <footer class="text-center text-sm py-4 w-full absolute bottom-0 text-gray-500">
            <!-- Párrafo eliminado -->
        </footer>
    </div>

    <!-- CONTENIDO PRINCIPAL DE LA SIMULACIÓN (Oculto hasta la autenticación) -->
    <div id="simulation-app" class="hidden">
        <header class="w-full max-w-4xl mx-auto py-6">
            <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-2">PHYSIO-PREPAS</h1>
            <p class="text-center text-lg text-gray-600">Simulación del Estado del Agua: Sólido, Líquido y Gaseoso</p>
        </header>

        <div id="app-container">
            <!-- Canvas de la simulación -->
            <div id="canvas-container">
                <canvas id="waterSimulation"></canvas>
            </div>

            <!-- Controles -->
            <div id="controls">
                
                <!-- 1. Controles de Estado -->
                <div class="control-group">
                    <h3 class="text-xl">Estado de la Materia</h3>
                    <div id="state-buttons" class="control-buttons flex space-x-2">
                        <button id="solidBtn" class="bg-blue-500 text-white active">Sólido</button>
                        <button id="liquidBtn" class="bg-blue-500 text-white">Líquido</button>
                        <button id="gasBtn" class="bg-blue-500 text-white">Gaseoso</button>
                    </div>
                </div>

                <!-- 2. Control de Temperatura -->
                <div class="control-group">
                    <h3 class="text-xl">Temperatura</h3>
                    <input type="range" id="temperatureSlider" min="0.01" max="1.5" step="0.01" value="0.5">
                    <div class="slider-label">
                        <span>Baja</span>
                        <span id="temperatureValue">0.5</span>
                        <span>Alta</span>
                    </div>
                </div>

                <!-- 3. Control de Fuerza de Enlace -->
                <div class="control-group">
                    <h3 class="text-xl">Fuerza de Enlace</h3>
                    <input type="range" id="bondStrengthSlider" min="0.0" max="0.05" step="0.001" value="0.02">
                    <div class="slider-label">
                        <span>Débil</span>
                        <span id="bondStrengthValue">0.02</span>
                        <span>Fuerte</span>
                    </div>
                </div>
                
            </div>
            
            <!-- Footer ajustado, se eliminó la referencia a PHYSIO-PREPAS -->
            <footer class="text-center text-sm py-4 text-gray-500">
                <p>Usuario: <span id="current-user-id" class="font-mono text-xs">Cargando...</span> | <button id="logout-button" class="text-blue-600 hover:text-blue-800 font-medium">Cerrar Sesión</button></p>
            </footer>
        </div>
    </div>


    <script type="module">
        // Importaciones necesarias de Firebase
        // IMPORTANTE: Se actualizan las URLs a la versión 12.3.0
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
        // NOTA: Se ha eliminado 'createUserWithEmailAndPassword' ya que el registro es externo.
        // Se mantiene la importación de setLogLevel para depuración, pero no es crucial aquí.
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
        
        // setLogLevel('Debug'); // Descomentar para ver logs detallados

        // --- 1. FIREBASE SETUP & AUTH LOGIC ---

        // ** CONFIGURACIÓN DE FIREBASE PARA PUBLICACIÓN EN GITHUB PAGES **
        // Se han insertado tus credenciales proporcionadas.
        const MY_FIREBASE_CONFIG = {
            apiKey: "AIzaSyDuUX0xG6-JuAQUrHSMTRDPwyEPq5dwjm4", 
            authDomain: "physio-prepas.firebaseapp.com",
            projectId: "physio-prepas",
            storageBucket: "physio-prepas.firebasestorage.app",
            messagingSenderId: "937118566487",
            appId: "1:937118566487:web:7183efb01604fd8d107b12"
            // measurementId: "G-WPP8EQD36D" // No es necesario para la autenticación
        };
        // FIN DE ** CONFIGURACIÓN DE FIREBASE **
        
        // La aplicación intentará primero usar la configuración inyectada por el entorno
        const dynamicAppId = typeof __app_id !== 'undefined' ? __app_id : MY_FIREBASE_CONFIG.appId || 'default-app-id';
        const dynamicFirebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app;
        let auth;

        // Referencias a elementos del DOM de Autenticación
        const authScreen = document.getElementById('auth-screen');
        const simulationApp = document.getElementById('simulation-app');
        const authForm = document.getElementById('auth-form');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const mainAuthButton = document.getElementById('main-auth-button');
        const authErrorMessage = document.getElementById('auth-error-message');
        const logoutButton = document.getElementById('logout-button');
        const currentUserIdEl = document.getElementById('current-user-id');
        
        // Mapeo de errores de Firebase a mensajes en español (simplificado)
        const firebaseErrorMessages = {
            'auth/invalid-email': 'El formato del email no es válido.',
            'auth/user-not-found': 'Email no registrado. Regístrate usando el enlace de abajo.',
            'auth/wrong-password': 'Contraseña incorrecta.',
            'auth/user-disabled': 'Tu cuenta ha sido deshabilitada. Contacta al administrador.',
            'auth/invalid-credential': 'Credenciales no válidas. Verifica tu email y contraseña.',
            'default': 'Ocurrió un error al iniciar sesión. Inténtalo de nuevo.'
        };

        function showAuthError(code) {
            const message = firebaseErrorMessages[code] || firebaseErrorMessages['default'];
            authErrorMessage.textContent = message;
            authErrorMessage.classList.remove('hidden');
        }

        function hideAuthError() {
            authErrorMessage.classList.add('hidden');
        }

        // Maneja el envío del formulario de autenticación (Solo Login)
        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideAuthError();
            
            const email = emailInput.value;
            const password = passwordInput.value;

            if (!email || !password) {
                showAuthError('default');
                return;
            }

            mainAuthButton.disabled = true;
            mainAuthButton.textContent = 'Accediendo...';

            try {
                // Solo permitimos el inicio de sesión
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                console.error("Auth Error:", error);
                showAuthError(error.code);
            } finally {
                mainAuthButton.disabled = false;
                mainAuthButton.textContent = 'Acceder a la Simulación';
            }
        });

        // Esta función ahora contiene el listener onAuthStateChanged
        function setupAuthListener() {
            // Listener principal del estado de autenticación
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // USUARIO AUTENTICADO: Mostrar la simulación
                    authScreen.classList.add('hidden');
                    simulationApp.classList.remove('hidden');
                    // Usar substring para que el ID sea manejable y visible
                    currentUserIdEl.textContent = user.uid.substring(0, 8) + '...'; 

                    // Verificar si la simulación ya se ha iniciado
                    if (!window.simulationStarted) {
                        startSimulation();
                        window.simulationStarted = true;
                    }
                } else {
                    // USUARIO DESCONECTADO: Mostrar la pantalla de login
                    authScreen.classList.remove('hidden');
                    simulationApp.classList.add('hidden');
                }
            });
        }


        function initFirebase() {
            try {
                // Determinar qué configuración usar: 
                // 1. La inyectada por el entorno (dynamicFirebaseConfig)
                // 2. La hardcodeada por el usuario para GitHub Pages (MY_FIREBASE_CONFIG)
                const configToUse = Object.keys(dynamicFirebaseConfig).length > 0
                    ? dynamicFirebaseConfig
                    : MY_FIREBASE_CONFIG;

                if (Object.keys(configToUse).length === 0 || configToUse.apiKey === "TU_API_KEY_AQUI" || configToUse.apiKey === "") {
                    // Si la configuración aún es la de placeholder o está vacía, mostramos un error.
                    console.error("ERROR: Configuración de Firebase faltante. Revisa MY_FIREBASE_CONFIG.");
                    authScreen.classList.remove('hidden');
                    authErrorMessage.textContent = 'ERROR FATAL: Debes configurar MY_FIREBASE_CONFIG con tus credenciales de Firebase.';
                    authErrorMessage.classList.remove('hidden');
                    return; 
                }
                
                // Inicializar Firebase con la configuración elegida
                app = initializeApp(configToUse);
                auth = getAuth(app);
                    
                if (initialAuthToken) {
                    // Usar token de autenticación inicial si existe
                    signInWithCustomToken(auth, initialAuthToken).catch(e => {
                        console.error("Fallo al autenticar con token inicial:", e);
                        authScreen.classList.remove('hidden');
                    }).finally(setupAuthListener);
                } else {
                    // Continuar con el listener normal si no hay token inicial
                    setupAuthListener(); 
                }
            } catch (error) {
                console.error("Error al inicializar Firebase:", error);
                console.error(`Error fatal al iniciar Firebase: ${error.message}`);
                authScreen.innerHTML = `<p class="text-red-500 text-center">Error fatal: ${error.message}</p>`;
            }
        }


        // --- 2. PHYSICS SIMULATION LOGIC (Envuelto en startSimulation) ---
        
        let canvas, ctx;
        let particles = [];
        let numParticles = 200;
        let currentState = 'solid';

        // Variables de control de la simulación
        let currentTemperature = 0.5; // (0.01 a 1.5) Afecta la velocidad inicial y aleatoria
        let currentBondStrength = 0.02; // (0.0 a 0.05) Afecta la fuerza de atracción/repulsión
        let attractionStrength = 0.01;
        let repulsionDistance = 30; // Distancia a la que empieza la repulsión

        // Elementos del DOM de la simulación
        const temperatureSlider = document.getElementById('temperatureSlider');
        const bondStrengthSlider = document.getElementById('bondStrengthSlider');
        const temperatureValueEl = document.getElementById('temperatureValue');
        const bondStrengthValueEl = document.getElementById('bondStrengthValue');
        const stateButtons = document.getElementById('state-buttons');

        // Clase para representar una partícula de agua (Molécula)
        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                // Velocidad inicial basada en la temperatura
                let angle = Math.random() * Math.PI * 2;
                let speed = Math.random() * currentTemperature * 2;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
                this.radius = 3;
                this.color = '#3b82f6'; // Azul
            }

            // Dibuja la partícula
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
            }

            // Aplica fuerzas de atracción o repulsión
            attract(other, strength) {
                const dx = other.x - this.x;
                const dy = other.y - this.y;
                const distSq = dx * dx + dy * dy;
                const dist = Math.sqrt(distSq);

                if (dist > 0) {
                    let force;
                    
                    if (currentState === 'solid' || currentState === 'liquid') {
                        // Fuerza de enlace (atracción) que es más fuerte en sólido
                        force = strength / distSq;
                        
                        // Si están demasiado cerca, repeler (evitar superposición)
                        if (dist < repulsionDistance) {
                            force -= (repulsionDistance - dist) * 0.001;
                        }
                    } else { // Gaseoso
                        // Fuerza de atracción insignificante, solo repulsión por proximidad
                        if (dist < repulsionDistance / 2) {
                            force = -0.005 / dist;
                        } else {
                            return; // No hay fuerzas en la fase gaseosa
                        }
                    }

                    const fx = force * (dx / dist);
                    const fy = force * (dy / dist);

                    // Aplicar la fuerza (masa=1)
                    this.vx += fx;
                    this.vy += fy;
                }
            }

            // Actualiza la posición y maneja los límites
            update() {
                // Movimiento Browniano/Térmico aleatorio (aumenta con la temperatura)
                this.vx += (Math.random() - 0.5) * currentTemperature * 0.1;
                this.vy += (Math.random() - 0.5) * currentTemperature * 0.1;

                this.x += this.vx;
                this.y += this.vy;

                // Fricción/Resistencia (disminuye la velocidad)
                this.vx *= 0.99;
                this.vy *= 0.99;

                // Rebotar en los límites del canvas
                if (this.x - this.radius < 0) {
                    this.x = this.radius;
                    this.vx *= -0.9; // Rebote
                } else if (this.x + this.radius > canvas.width) {
                    this.x = canvas.width - this.radius;
                    this.vx *= -0.9;
                }

                if (this.y - this.radius < 0) {
                    this.y = this.radius;
                    this.vy *= -0.9;
                } else if (this.y + this.radius > canvas.height) {
                    this.y = canvas.height - this.radius;
                    this.vy *= -0.9;
                }
            }
        }

        // Distribuye las partículas en el canvas
        function populateParticles() {
            particles = [];
            const cols = 20;
            const rows = numParticles / cols;
            const spacing = Math.min(canvas.width, canvas.height) / cols;
            const startX = (canvas.width - cols * spacing) / 2 + spacing / 2;
            const startY = (canvas.height - rows * spacing) / 2 + spacing / 2;

            for (let i = 0; i < numParticles; i++) {
                let col = i % cols;
                let row = Math.floor(i / cols);

                let x = startX + col * spacing + (Math.random() - 0.5) * 5;
                let y = startY + row * spacing + (Math.random() - 0.5) * 5;

                particles.push(new Particle(x, y));
            }
        }

        // Ajusta los parámetros de la simulación según el estado
        function changeState(newState) {
            currentState = newState;

            // Remueve la clase 'active' de todos los botones
            document.querySelectorAll('#state-buttons button').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-700');
                btn.classList.add('bg-blue-500');
            });

            // Aplica la clase 'active' al botón seleccionado
            const activeBtn = document.getElementById(newState + 'Btn');
            if (activeBtn) {
                activeBtn.classList.remove('bg-blue-500');
                activeBtn.classList.add('active', 'bg-blue-700');
            }

            // Configuración de estado
            if (newState === 'solid') {
                // Sólido: Baja T°, Alta fuerza de enlace (F. Enlace)
                currentTemperature = 0.1;
                currentBondStrength = 0.04;
                repulsionDistance = 30;
                numParticles = 200;
                populateParticles();
            } else if (newState === 'liquid') {
                // Líquido: T° moderada, F. Enlace moderada
                currentTemperature = 0.5;
                currentBondStrength = 0.02;
                repulsionDistance = 15;
            } else if (newState === 'gas') {
                // Gaseoso: Alta T°, F. Enlace baja/cero
                currentTemperature = 1.0;
                currentBondStrength = 0.00;
                repulsionDistance = 10;
            }

            // Sincronizar sliders
            temperatureSlider.value = currentTemperature;
            bondStrengthSlider.value = currentBondStrength;
            temperatureValueEl.textContent = currentTemperature.toFixed(2);
            bondStrengthValueEl.textContent = currentBondStrength.toFixed(3);
        }


        // Loop principal de la animación
        function animate() {
            // Limpia el canvas
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--canvas-bg-light').trim();
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Fuerza de atracción para esta iteración
            attractionStrength = parseFloat(bondStrengthSlider.value);

            // Iterar sobre las partículas
            particles.forEach((p1, i) => {
                // Solo calcula las fuerzas si no es gaseoso puro
                if (currentState !== 'gas') {
                    for (let j = i + 1; j < particles.length; j++) {
                        const p2 = particles[j];

                        // Aplica la fuerza de atracción/repulsión entre pares
                        p1.attract(p2, attractionStrength);
                        p2.attract(p1, attractionStrength); // Tercera Ley de Newton
                    }
                }
                
                // Actualiza la temperatura para el movimiento browniano
                currentTemperature = parseFloat(temperatureSlider.value);
                
                p1.update();
                p1.draw();
            });

            requestAnimationFrame(animate);
        }

        // --- 3. FUNCIÓN DE INICIO PRINCIPAL ---

        function setupCanvas() {
            canvas = document.getElementById('waterSimulation');
            ctx = canvas.getContext('2d');
            
            // Ajustar tamaño del canvas al contenedor
            const container = document.getElementById('canvas-container');
            const rect = container.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 400; // Altura fija por ahora
        }

        // Esta es la función que ejecuta la simulación (se llama solo después de la autenticación)
        function startSimulation() {
            setupCanvas();

            // EventListeners para la simulación

            // Agrega los EventListeners a los botones de estado del agua
            document.getElementById('solidBtn').addEventListener('click', () => changeState('solid'));
            document.getElementById('liquidBtn').addEventListener('click', () => changeState('liquid'));
            document.getElementById('gasBtn').addEventListener('click', () => changeState('gas'));

            // Los sliders solo actualizan los valores globales y muestran el valor
            temperatureSlider.addEventListener('input', (e) => {
                currentTemperature = parseFloat(e.target.value);
                temperatureValueEl.textContent = currentTemperature.toFixed(2);
            });

            bondStrengthSlider.addEventListener('input', (e) => {
                currentBondStrength = parseFloat(e.target.value);
                bondStrengthValueEl.textContent = currentBondStrength.toFixed(3);
            });
            
            // Inicializar la simulación en estado sólido
            changeState('solid');
            
            // Iniciar el loop de animación
            animate();
        }

        // --- 4. INICIALIZACIÓN GLOBAL ---

        window.onload = function () {
            // Asignación de evento para cerrar sesión debe ir aquí o después de obtener el botón
             logoutButton.addEventListener('click', async () => {
                try {
                    await signOut(auth);
                } catch (error) {
                    console.error("Error al cerrar sesión:", error);
                    // Sustituir alert()
                    console.error("No se pudo cerrar la sesión."); 
                }
            });
            
            // 1. Inicializa Firebase (esto configura el listener onAuthStateChanged)
            initFirebase();
        };

    </script>

</body>
</html>
